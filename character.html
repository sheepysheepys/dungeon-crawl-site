<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Character</title>

    <link rel="stylesheet" href="/dungeon-crawl-site/css/character.css" />
  </head>

  <body>
    <div class="sheet">
      <!-- HEADER -->
      <header class="sheet-header sheet-header--inline">
        <div class="brand">
          <div class="brand-title">DUNGEON CRAWLER</div>
          <div class="brand-sub">Character Sheet</div>
        </div>

        <div class="id-grid id-grid--with-level">
          <label class="field">
            <span class="field-label">Name</span>
            <span id="charName" class="field-value">—</span>
          </label>
          <label class="field">
            <span class="field-label">Race</span>
            <span id="charRace" class="field-value">—</span>
          </label>
          <label class="field">
            <span class="field-label">Class</span>
            <span id="charClass" class="field-value">—</span>
          </label>

          <div class="field level-field">
            <span class="field-label">Level</span>
            <div class="level-pill"><span id="charLevelNum">1</span></div>
            <button id="btnLevelUp" class="btn-accent">Level Up</button>
          </div>
        </div>
      </header>

      <!-- ABILITY SCORES -->
      <section class="box" id="statsCard">
        <span class="label-corner">Abilities</span>
        <div class="abilities">
          <div class="ability" data-stat="agility">
            <div class="abbr">Agility</div>
            <div class="circle">
              <div style="text-align: center">
                <div class="score mono" id="stat-agility-total">—</div>
              </div>
            </div>
            <div class="break mono" id="stat-agility-break">—</div>
            <div class="tags">sprint • dodge • leap</div>
          </div>

          <div class="ability" data-stat="strength">
            <div class="abbr">Strength</div>
            <div class="circle">
              <div style="text-align: center">
                <div class="score mono" id="stat-strength-total">—</div>
              </div>
            </div>
            <div class="break mono" id="stat-strength-break">—</div>
            <div class="tags">lift • smash • grapple</div>
          </div>

          <div class="ability" data-stat="finesse">
            <div class="abbr">Finesse</div>
            <div class="circle">
              <div style="text-align: center">
                <div class="score mono" id="stat-finesse-total">—</div>
              </div>
            </div>
            <div class="break mono" id="stat-finesse-break">—</div>
            <div class="tags">control • hide • tinker</div>
          </div>

          <div class="ability" data-stat="instinct">
            <div class="abbr">Instinct</div>
            <div class="circle">
              <div style="text-align: center">
                <div class="score mono" id="stat-instinct-total">—</div>
              </div>
            </div>
            <div class="break mono" id="stat-instinct-break">—</div>
            <div class="tags">perceive • sense • navigate</div>
          </div>

          <div class="ability" data-stat="presence">
            <div class="abbr">Presence</div>
            <div class="circle">
              <div style="text-align: center">
                <div class="score mono" id="stat-presence-total">—</div>
              </div>
            </div>
            <div class="break mono" id="stat-presence-break">—</div>
            <div class="tags">charm • perform • deceive</div>
          </div>

          <div class="ability" data-stat="knowledge">
            <div class="abbr">Knowledge</div>
            <div class="circle">
              <div style="text-align: center">
                <div class="score mono" id="stat-knowledge-total">—</div>
              </div>
            </div>
            <div class="break mono" id="stat-knowledge-break">—</div>
            <div class="tags">recall • analyze • comprehend</div>
          </div>
        </div>
      </section>

      <div class="sheet-body">
        <div id="msg" class="muted"></div>

        <!-- ================== TOP GRID ================== -->
        <div class="top-grid">
          <!-- HP -->
          <section class="box" id="hpCard">
            <span class="label-corner">Health</span>
            <h3>HP</h3>
            <div class="row">
              <div class="big">
                <span id="hpCurrent">—</span><span class="muted"> / </span
                ><span id="hpTotal">—</span>
              </div>
              <div class="spacer"></div>
              <button class="btn-good" id="btnHpPlus">+1</button>
              <button class="btn-bad" id="btnHpMinus">-1</button>
              <button class="btn-accent" id="btnDamageCalc">
                Damage Calculator
              </button>
            </div>

            <div class="hp-track"><div class="hp-bar" id="hpBar"></div></div>

            <div class="thresholds thresholds-2">
              <div>
                <span class="label">T1</span>
                <span id="thT1" class="mono chip">7</span>
              </div>
              <div>
                <span class="label">T2</span>
                <span id="thT2" class="mono chip">14</span>
              </div>
            </div>

            <div class="mono muted" style="margin-top: 6px; font-size: 12px">
              <!-- Damage legend -->
              <div id="dmgLegend" class="dmg-legend">
                <div class="band">
                  <span class="tag tag-light">Light</span>
                  <span class="range">0–<span id="t1Val">7</span></span>
                  <span class="hp">−1 HP</span>
                </div>
                <div class="band">
                  <span class="tag tag-heavy">Heavy</span>
                  <span class="range"
                    ><span id="t2Low">8</span>–<span id="t2Val">14</span></span
                  >
                  <span class="hp">−2 HP</span>
                </div>
                <div class="band">
                  <span class="tag tag-brutal">Brutal</span>
                  <span class="range"><span id="t3Low">15</span>+</span>
                  <span class="hp">−3 HP</span>
                </div>
              </div>
            </div>

            <div class="row rest-row">
              <button id="btnShortRest" class="btn">Short Rest</button>
              <button id="btnLongRest" class="btn">Long Rest</button>
            </div>
          </section>

          <!-- Armor (medium) -->
          <section class="box medium" id="armorCard">
            <span class="label-corner">Armor</span>
            <h3>Active Armor</h3>
            <div class="row armor-inline">
              <div>
                Clothing Level: <span id="exoOn" class="mono chip">0</span>
                <span class="muted">/ 5</span>
              </div>
              <div class="spacer"></div>
              <div>
                Pieces Stripped:
                <span id="strippedPieces" class="mono chip">0</span>
              </div>
            </div>
            <div class="armor-track">
              <div class="tick"></div>
              <div class="tick"></div>
              <div class="tick"></div>
              <div class="tick"></div>
              <div class="tick"></div>
            </div>
          </section>

          <!-- Evasion (compact) -->
          <section class="box compact" id="evasionCard">
            <span class="label-corner">Evasion</span>
            <div class="meter"><div class="big mono" id="evasion">—</div></div>
          </section>

          <!-- Hope (compact) -->
          <section class="box compact" id="hopeCard">
            <span class="label-corner">Hope</span>
            <div class="row">
              <div class="big" id="hopeDots" aria-live="polite">—</div>
              <div class="spacer"></div>
              <button id="btnHopePlus" class="btn-good">+</button>
              <button id="btnHopeMinus" class="btn-bad">−</button>
            </div>
            <div class="muted">Max 5.</div>
          </section>

          <!-- Experience (now in the grid, 2nd row 3rd col) -->
          <section class="box" id="experienceCard">
            <span class="label-corner">Experience</span>
            <h3>Experience</h3>
            <div class="xp-list" id="xpList">
              <div class="xp-row">
                <span class="xp-name">Royal Mage</span>
                <span class="xp-bonus">+2</span>
                <span class="xp-notch" aria-hidden="true"></span>
              </div>
              <div class="xp-row">
                <span class="xp-name">Not On My Watch</span>
                <span class="xp-bonus">+1</span>
                <span class="xp-notch" aria-hidden="true"></span>
              </div>
              <div class="xp-row xp-empty">
                <span></span><span></span><span class="xp-notch"></span>
              </div>
              <div class="xp-row xp-empty">
                <span></span><span></span><span class="xp-notch"></span>
              </div>
            </div>
          </section>
        </div>
        <!-- =============== /TOP GRID ================== -->

        <!-- Now the rest of the sheet content -->
        <section class="box" id="weaponsCard">
          <span class="label-corner">Weapons</span>
          <h3>Active Weapons</h3>
          <div id="activeWeapons" class="list"></div>
          <div id="weaponsEmpty" class="muted">No active weapons.</div>
        </section>

        <!-- TABS -->
        <nav class="tabs">
          <div class="tab active" data-tab="abilities">Abilities</div>
          <div class="tab" data-tab="equipment">Equipment</div>
          <div class="tab" data-tab="inventory">Inventory</div>
          <div class="tab" data-tab="notes">Notes</div>
          <div class="tab" data-tab="viewership">Viewership</div>
          <div class="tab" data-tab="awards">
            Awards & Loot
            <span id="lootBadge" class="badge" style="display: none">0</span>
          </div>
        </nav>

        <section class="page active" id="page-abilities">
          <div class="list" id="abilitiesList"></div>
          <div class="muted" id="abilitiesEmpty">No abilities yet.</div>
        </section>

        <section class="page" id="page-equipment">
          <div class="grid equip-grid">
            <!-- Left: Silhouette + totals -->
            <section class="box" id="equipmentArmorSilhouette">
              <span class="label-corner">Armor</span>
              <h3>Armor Overview</h3>

              <div class="silhouette-wrap">
                <svg
                  class="silhouette"
                  viewBox="0 0 120 220"
                  role="img"
                  aria-label="Armor silhouette"
                >
                  <!-- Underlay: reference shapes only (not painted) -->
                  <g class="base">
                    <circle cx="60" cy="22" r="14" />
                    <rect x="38" y="40" width="44" height="46" rx="8" />
                    <rect x="48" y="86" width="24" height="40" rx="6" />
                    <rect x="48" y="128" width="24" height="52" rx="6" />
                    <rect x="50" y="188" width="20" height="8" rx="4" />
                  </g>

                  <!-- Overlays: EXACTLY 5 paintable regions -->
                  <g class="overlay">
                    <!-- HEAD -->
                    <circle
                      class="slot-region"
                      data-slot="head"
                      cx="60"
                      cy="22"
                      r="14"
                    />

                    <!-- CHEST -->
                    <rect
                      class="slot-region"
                      data-slot="chest"
                      x="38"
                      y="40"
                      width="44"
                      height="46"
                      rx="8"
                    />

                    <!-- HANDS (shoulder/arms bar) -->
                    <rect
                      class="slot-region"
                      data-slot="hands"
                      x="24"
                      y="44"
                      width="72"
                      height="14"
                      rx="6"
                    />

                    <!-- LEGS -->
                    <rect
                      class="slot-region"
                      data-slot="legs"
                      x="48"
                      y="128"
                      width="24"
                      height="52"
                      rx="6"
                    />

                    <!-- FEET (shorter) -->
                    <rect
                      class="slot-region"
                      data-slot="feet"
                      x="50"
                      y="188"
                      width="20"
                      height="8"
                      rx="4"
                    />
                  </g>
                </svg>
              </div>

              <!-- Totals strip -->
              <div class="totals">
                <div class="total-row">
                  <div class="label">Exo left</div>
                  <div class="value mono" id="silExoLeft">—</div>
                  <div class="pips" aria-label="Exo pieces remaining">
                    <span class="pip"></span><span class="pip"></span
                    ><span class="pip"></span><span class="pip"></span
                    ><span class="pip"></span>
                  </div>
                </div>

                <div class="total-row">
                  <div class="label">Armor pieces</div>
                  <div class="value mono" id="silArmorCount">0</div>
                </div>

                <div class="total-row protection">
                  <div class="label">Protection</div>
                  <div class="value mono" id="silProtectionTotal">0</div>
                  <div class="hint muted">= Exo + Armor</div>
                </div>
              </div>
            </section>

            <!-- Right: Other gear (keeps your existing IDs) -->
            <section class="box" id="equipmentOther">
              <span class="label-corner">Gear</span>
              <h3>Other Gear</h3>
              <div class="list" id="equipmentList"></div>
              <div class="muted" id="equipmentEmpty"></div>
            </section>
          </div>
        </section>

        <section class="page" id="page-inventory">
          <div id="inventoryAllList" class="list"></div>
          <div class="muted" id="inventoryEmpty">Inventory is empty.</div>
          <div class="row" style="margin-top: 10px">
            <input id="addItemName" type="text" placeholder="Add item name…" />
            <input
              id="addItemQty"
              type="number"
              value="1"
              min="1"
              style="width: 90px"
            />
            <button id="btnAddItem" class="btn-accent">Add</button>
          </div>
        </section>

        <section class="page" id="page-notes">
          <div class="box">
            <span class="label-corner">Notes</span>
            <h3>Character Notes</h3>
            <textarea id="notes" rows="6" style="width: 100%"></textarea>
            <div class="row" style="margin-top: 8px; justify-content: flex-end">
              <button id="btnSaveNotes" class="btn-accent">Save Notes</button>
            </div>
          </div>
        </section>

        <section class="page" id="page-viewership">
          <div class="page" id="page-viewership">
            <section class="box">
              <h3>Viewership</h3>
              <div
                class="muted"
                style="margin-top: 8px; text-align: center; padding: 20px"
              >
                📺 This feature is <strong>coming soon</strong>.<br />
                Crawler viewer stats will not be released until the next floor.
              </div>
            </section>
          </div>

          <!-- <div class="grid stats3">
            <div class="box">
              <span class="label-corner">Fans</span>
              <h3>Followers</h3>
              <div class="big" id="followers">—</div>
            </div>
            <div class="box">
              <span class="label-corner">Live</span>
              <h3>Live Viewers</h3>
              <div class="big" id="liveViewers">—</div>
            </div>
            <div class="box">
              <span class="label-corner">All-Time</span>
              <h3>Lifetime Views</h3>
              <div class="big" id="lifetimeViews">—</div>
            </div>
          </div> -->
        </section>

        <section id="page-awards" class="page">
          <div class="card" style="margin-bottom: 16px">
            <h3 style="margin: 0 0 8px">Pending Loot Boxes</h3>
            <div id="lootList" class="list"></div>
          </div>

          <div class="card">
            <h3 style="margin: 0 0 8px">Achievements</h3>
            <div id="awardsList" class="list"></div>
          </div>
        </section>
      </div>
    </div>

    <!-- Modals -->
    <div class="modal-backdrop" id="restModalBack">
      <div
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="restModalTitle"
      >
        <h3 id="restModalTitle">Rest</h3>
        <div id="restOptions" class="list" style="margin: 8px 0 12px"></div>
        <div class="row" style="justify-content: flex-end">
          <button id="btnConfirmRest" class="btn-accent">Confirm</button>
          <button id="btnCloseRestModal">Close</button>
        </div>
      </div>
    </div>

    <div class="modal-backdrop" id="modalBack">
      <div class="modal">
        <h3>Damage Calculator</h3>
        <div class="row" style="justify-content: flex-start">
          <label
            >Damage:&nbsp;<input
              id="calcDamage"
              type="number"
              min="0"
              value="0"
          /></label>
        </div>
        <div id="calcResult" style="margin: 10px 0" class="mono muted">
          Enter a number and press Calculate.
        </div>
        <div class="row">
          <div class="spacer"></div>
          <button id="btnCalc" class="btn-accent">Calculate</button>
          <button id="btnApplyDamage" class="btn-bad">Apply</button>
          <button id="btnCloseModal">Close</button>
        </div>
      </div>
    </div>

    <div class="modal-backdrop" id="levelModalBack">
      <div
        class="modal modal-lg"
        role="dialog"
        aria-modal="true"
        aria-labelledby="levelModalTitle"
      >
        <h3 id="levelModalTitle">Level Up</h3>

        <div class="muted" style="margin: 2px 0 10px">
          You always gain <strong>+1 Max HP</strong>. Choose
          <strong>one</strong> bonus:
        </div>

        <div class="lu-choices">
          <!-- Bonus A: Extra +1 Max HP (total +2 this level) -->
          <label class="choice-card">
            <input
              type="radio"
              name="luChoice"
              id="luChoiceHp"
              value="hp"
              checked
            />
            <div class="choice-content">
              <div class="choice-title">Extra +1 Max HP</div>
              <div class="choice-desc muted">Total +2 Max HP this level.</div>
            </div>
          </label>

          <!-- Bonus B: +1 Ability -->
          <label class="choice-card">
            <input
              type="radio"
              name="luChoice"
              id="luChoiceStat"
              value="stat"
            />
            <div class="choice-content">
              <div class="choice-title">+1 to an Ability</div>
              <div class="choice-desc muted">Raise one ability score by 1.</div>
              <div class="row" style="margin-top: 8px">
                <select
                  id="luAbilityKey"
                  disabled
                  style="min-width: 240px"
                ></select>
              </div>
            </div>
          </label>
        </div>

        <div class="row" style="margin-top: 14px">
          <div class="spacer"></div>
          <button id="btnConfirmLevelUp" class="btn-accent" disabled>
            Confirm
          </button>
          <button id="btnCloseLevelModal">Close</button>
        </div>
      </div>
    </div>

    <!-- scripts -->
    <script>
      window.App = window.App || { Features: {}, Logic: {} };
      window.AppState = window.AppState || { user: null, character: null };
      console.log('[boot] namespaces ready', {
        hasApp: !!window.App,
        hasFeatures: !!(window.App && window.App.Features),
        hasLogic: !!(window.App && window.App.Logic),
      });
    </script>

    <script
      defer
      src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"
    ></script>
    <script defer src="/dungeon-crawl-site/js/supabase-client.js"></script>

    <script defer src="/dungeon-crawl-site/js/ui-helpers.js"></script>
    <script defer src="/dungeon-crawl-site/js/modal-helpers.js"></script>
    <script defer src="/dungeon-crawl-site/js/traits-helpers.js"></script>

    <script defer src="/dungeon-crawl-site/js/logic/armor.js"></script>
    <script defer src="/dungeon-crawl-site/js/logic/strip.js"></script>
    <script defer src="/dungeon-crawl-site/js/logic/inventory.js"></script>
    <script defer src="/dungeon-crawl-site/js/logic/rests.js"></script>
    <script defer src="/dungeon-crawl-site/js/logic/evasion.js"></script>
    <script defer src="/dungeon-crawl-site/js/logic/combat.js"></script>

    <script defer src="/dungeon-crawl-site/js/features/inventory.js"></script>
    <script defer src="/dungeon-crawl-site/js/features/equipment.js"></script>
    <script defer src="/dungeon-crawl-site/js/features/abilities.js"></script>
    <script defer src="/dungeon-crawl-site/js/features/awards-loot.js"></script>
    <script defer src="/dungeon-crawl-site/js/features/rests-ui.js"></script>

    <script
      defer
      src="/dungeon-crawl-site/js/features/equipment-ui.js"
    ></script>
    <script
      defer
      src="/dungeon-crawl-site/js/features/equipment-silhouette.js"
    ></script>

    <script defer src="/dungeon-crawl-site/js/character.js"></script>
  </body>
</html>
