<!-- Keep your existing markup; here's the script block logic changes -->
<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js';
  const supabase = createClient(
    'https://fqegrllwoskrfcnmzlod.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZxZWdybGx3b3NrcmZjbm16bG9kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0ODk1ODEsImV4cCI6MjA3MDA2NTU4MX0.bI0gGkXD8U-C9lhOkWgJ0QN9swx0lLX5rFpVpI_D2DE'
  );

  const userStr = localStorage.getItem('user');
  if (!userStr) window.location.href = 'login.html';
  const user = JSON.parse(userStr);

  // role gate: DMs don't create characters
  const { data: profile } = await supabase
    .from('profiles')
    .select('role')
    .eq('id', user.id)
    .single();
  if (profile?.role === 'dm') {
    window.location.href = 'dm-dashboard.html';
  }

  document.getElementById('createBtn').addEventListener('click', async () => {
    const name = document.getElementById('charName').value.trim();
    if (!name) return alert('Please enter a character name.');

    const { error } = await supabase.from('characters').insert([
      {
        user_id: user.id,
        name,
        level: 1,
        hp_current: 100,
        hp_max: 100,
        armor_hp: 50,
        armor_state: 'intact',
        stripping_stage: 0,
      },
    ]);

    if (error) alert('Error creating character: ' + error.message);
    else window.location.href = 'character.html';
  });
</script>
